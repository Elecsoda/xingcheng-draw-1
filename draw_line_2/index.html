<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¡Œç¨‹é—®é¢˜æ€ç»´å¯è§†åŒ– - ä¸“é¡¹è®­ç»ƒ</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;700&display=swap');
        body { font-family: 'Noto Sans SC', sans-serif; background-color: #f0f9ff; }
        .fade-in { animation: fadeIn 0.5s ease-in; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        .road {
            background-color: #e2e8f0;
            border-bottom: 4px solid #94a3b8;
        }
        
        /* æ’­æ”¾æŒ‰é’®è„‰å†² - ç”¨äºåº•éƒ¨æŒ‰é’® */
        .pulse-btn {
            animation: pulse-shadow 2s infinite;
        }
        @keyframes pulse-shadow {
            0% { box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(59, 130, 246, 0); }
            100% { box-shadow: 0 0 0 0 rgba(59, 130, 246, 0); }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // å›¾æ ‡ç»„ä»¶
        const Icons = {
            MapIcon: ({ size = 24, className = "" }) => (
                <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><polygon points="1 6 1 22 8 18 16 22 23 18 23 2 16 6 8 2 1 6"></polygon><line x1="8" y1="2" x2="8" y2="18"></line><line x1="16" y1="6" x2="16" y2="22"></line></svg>
            ),
            RefreshCw: ({ size = 24, className = "" }) => (
                <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M23 4v6h-6"></path><path d="M1 20v-6h6"></path><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path></svg>
            ),
            Play: ({ size = 24, className = "" }) => (
                <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><polygon points="5 3 19 12 5 21 5 3"></polygon></svg>
            ),
            Highlighter: ({ size = 24, className = "" }) => (
                <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="m9 11-6 6v3h9l3-3"></path><path d="m22 12-4.6 4.6a2 2 0 0 1-2.8 0l-5.2-5.2a2 2 0 0 1 0-2.8L14 4"></path></svg>
            ),
            Pencil: ({ size = 24, className = "" }) => (
                <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"></path></svg>
            ),
            Calculator: ({ size = 24, className = "" }) => (
                <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><rect x="4" y="2" width="16" height="20" rx="2"></rect><line x1="8" y1="6" x2="16" y2="6"></line><line x1="16" y1="14" x2="16" y2="18"></line><path d="M16 10h.01"></path><path d="M12 10h.01"></path><path d="M8 10h.01"></path><path d="M12 14h.01"></path><path d="M8 14h.01"></path><path d="M12 18h.01"></path><path d="M8 18h.01"></path></svg>
            ),
            ChevronRight: ({ size = 24, className = "" }) => (
                <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><polyline points="9 18 15 12 9 6"></polyline></svg>
            ),
            CheckCircle: ({ size = 24, className = "" }) => (
                <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline></svg>
            ),
            Users: ({ size = 24, className = "" }) => (
                <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M23 21v-2a4 4 0 0 0-3-3.87"></path><path d="M16 3.13a4 4 0 0 1 0 7.75"></path></svg>
            ),
            Train: ({ size = 24, className = "" }) => (
                <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><rect x="2" y="5" width="20" height="14" rx="2"></rect><line x1="2" y1="10" x2="22" y2="10"></line><line x1="5" y1="19" x2="5" y2="21"></line><line x1="19" y1="19" x2="19" y2="21"></line></svg>
            ),
            TrendingUp: ({ size = 24, className = "" }) => (
                <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"></polyline><polyline points="17 6 23 6 23 12"></polyline></svg>
            ),
            PlayCircle: ({ size = 24, className = "" }) => (
                <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><circle cx="12" cy="12" r="10"></circle><polygon points="10 8 16 12 10 16 10 8" fill="currentColor"></polygon></svg>
            ),
            PauseCircle: ({ size = 24, className = "" }) => (
                <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><circle cx="12" cy="12" r="10"></circle><line x1="10" y1="15" x2="10" y2="9"></line><line x1="14" y1="15" x2="14" y2="9"></line></svg>
            ),
            SkipForward: ({ size = 24, className = "" }) => (
                <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><polygon points="5 4 15 12 5 20 5 4"></polygon><line x1="19" y1="5" x2="19" y2="19"></line></svg>
            )
        };

        const { Play, PlayCircle, PauseCircle, SkipForward, RefreshCw, ChevronRight, Calculator, Highlighter, MapIcon, Pencil, CheckCircle, Users, Train, TrendingUp } = Icons;

        const STEPS = {
            READ: 0,
            HIGHLIGHT: 1,
            ANIMATE: 2,
            DIAGRAM: 3,
            FORMULA: 4
        };

        const STEP_CONFIG = [
            { id: STEPS.READ, label: "è¯»é¢˜", icon: <MapIcon size={16}/> },
            { id: STEPS.HIGHLIGHT, label: "æ‰¾é‡ç‚¹", icon: <Highlighter size={16}/> },
            { id: STEPS.ANIMATE, label: "çœ‹åŠ¨ç”»", icon: <Play size={16}/> },
            { id: STEPS.DIAGRAM, label: "ç”»çº¿æ®µ", icon: <Pencil size={16}/> },
            { id: STEPS.FORMULA, label: "åˆ—ç®—å¼", icon: <Calculator size={16}/> }
        ];

        // åœºæ™¯æ•°æ®é…ç½®
        const SCENARIOS = {
            MEETING: {
                id: 'meeting',
                title: 'ä¸­ç‚¹ç›¸é‡é—®é¢˜',
                icon: <Users size={20}/>,
                maxDiagramStep: 3, 
                params: { 
                    v1: 18, 
                    v2: 15, 
                    t: 2, // 2å°æ—¶
                    offset: 3, // è·ä¸­ç‚¹3åƒç±³
                    label1: "å°çº¢", 
                    label2: "å°æ˜", 
                    unit: "åƒç±³/æ—¶" 
                },
                getInstruction: (step, subStep) => {
                     if(step === STEPS.DIAGRAM) {
                        if(subStep===0) return "1. ç”»å‡ºå…¨ç¨‹çº¿æ®µï¼Œæ ‡å‡ºä¸­ç‚¹ï¼ˆè™šçº¿ï¼‰ã€‚";
                        if(subStep===1) return "2. å°çº¢é€Ÿåº¦å¿«ï¼Œå°æ˜é€Ÿåº¦æ…¢ï¼Œç›¸é‡ç‚¹åœ¨ä¸­ç‚¹åå³è¿˜æ˜¯åå·¦ï¼Ÿ";
                        if(subStep===2) return "3. æ ‡å‡ºç›¸é‡ç‚¹ã€‚æ³¨æ„é¢˜ç›®æ¡ä»¶ï¼šè·ä¸­ç‚¹ 3 åƒç±³ã€‚";
                        return "4. æ€è€ƒï¼šå°çº¢æ¯”å°æ˜å¤šèµ°äº†å¤šå°‘ï¼Ÿ";
                    }
                    return null;
                }
            },
            DOUBLE: {
                id: 'double',
                title: 'äºŒæ¬¡ç›¸é‡é—®é¢˜',
                icon: <TrendingUp size={20}/>,
                maxDiagramStep: 5, // æ­¥éª¤ 0-5 å…±6æ­¥
                params: { 
                    vA: 80, 
                    vB: 60, 
                    vC: 50, 
                    dt: 8, // 8åˆ†é’Ÿ
                    labelA: "ç”²", 
                    labelB: "ä¹™", 
                    labelC: "ä¸™",
                    t1: 104, // ç¬¬ä¸€æ¬¡ç›¸é‡æ—¶é—´
                    unit: "ç±³/åˆ†"
                },
                getInstruction: (step, subStep) => {
                    if(step === STEPS.ANIMATE) return "è§‚å¯ŸåŠ¨ç”»ï¼Œæ³¨æ„ä¸¤ä¸ªæš‚åœæ—¶åˆ»ï¼šç¬¬ä¸€æ¬¡ç›¸é‡ï¼ˆç”²ä¹™ï¼‰å’Œç¬¬äºŒæ¬¡ç›¸é‡ï¼ˆç”²ä¸™ï¼‰ã€‚";
                    if(step === STEPS.DIAGRAM) {
                       if(subStep===0) return "ç¬¬ä¸€æ­¥ï¼šç”»å‡ºä¸€æ¡çº¿æ®µï¼Œæ ‡ä¸ŠAã€Bä¸¤åœ°ã€‚";
                       if(subStep===1) return "ç¬¬äºŒæ­¥ï¼šæ ‡å‡ºç”²ï¼ˆAåœ°ï¼‰ï¼Œä¹™ã€ä¸™ï¼ˆBåœ°ï¼‰çš„ä½ç½®ã€‚";
                       if(subStep===2) return "ç¬¬ä¸‰æ­¥ï¼šæ ‡å‡ºç®­å¤´æ–¹å‘ï¼Œè¡¨ç¤ºâ€œç›¸å‘è€Œè¡Œâ€ã€‚";
                       if(subStep===3) return "ç¬¬å››æ­¥ï¼šç”»å‡ºç”²å’Œä¹™çš„è·¯çº¿ï¼Œæ ‡å‡ºã€ç¬¬ä¸€æ¬¡ç›¸é‡ã€‘ç‚¹ã€‚";
                       if(subStep===4) return "ç¬¬äº”æ­¥ï¼šç”»å‡ºç”²ç»§ç»­å‰è¡Œï¼Œä¸ä¸™çš„ã€ç¬¬äºŒæ¬¡ç›¸é‡ã€‘ç‚¹ã€‚";
                       return "ç¬¬å…­æ­¥ï¼šé‡ç‚¹ï¼æ ‡å‡ºä¸¤æ¬¡ç›¸é‡ä¹‹é—´ç›¸éš”çš„ã€8åˆ†é’Ÿã€‘ï¼Œè¿™å°±æ˜¯è§£é¢˜çš„å…³é”®ï¼";
                   }
                   return null;
               }
            }
        };

        const App = () => {
            const [scenario, setScenario] = useState('meeting');
            const [step, setStep] = useState(STEPS.READ);
            const [time, setTime] = useState(0);
            const [isPlaying, setIsPlaying] = useState(false); 
            const [diagramSubStep, setDiagramSubStep] = useState(0); 
            
            // Phase for animation: 0=Start, 1=Meet1 Pause, 2=Finished/Meet2
            const [phase, setPhase] = useState(0); 
            
            const config = SCENARIOS[scenario.toUpperCase()];
            const { v1, v2, t, label1, label2, offset, vA, vB, vC, dt, labelA, labelB, labelC, t1 } = config.params;
            
            const animationRef = useRef(null);
            const startTimeRef = useRef(null);
            const startFromTimeRef = useRef(0);

            // åˆ‡æ¢åœºæ™¯
            const switchScenario = (key) => {
                setScenario(key);
                setStep(STEPS.READ);
                resetAnimation();
                setDiagramSubStep(0);
            };

            const resetAnimation = () => {
                setTime(0);
                setIsPlaying(false);
                setPhase(0);
                if (animationRef.current) cancelAnimationFrame(animationRef.current);
            };

            const changeStep = (newStep) => {
                setStep(newStep);
                setDiagramSubStep(0);
                
                if (newStep === STEPS.ANIMATE) {
                    resetAnimation();
                } else if (newStep > STEPS.ANIMATE) {
                    const maxTime = (scenario === 'double') ? (t1 + dt) : t;
                    setTime(maxTime);
                    setIsPlaying(false);
                    setPhase(2);
                } else {
                    resetAnimation();
                }
            };

            const handleNextClick = () => {
                if (step === STEPS.DIAGRAM && diagramSubStep < config.maxDiagramStep) {
                    setDiagramSubStep(prev => prev + 1);
                } else {
                    changeStep(step + 1);
                }
            };

            // æ ¸å¿ƒåŠ¨ç”»å¾ªç¯
            const startAnimation = () => {
                const maxTime = (scenario === 'double') ? (t1 + dt) : t;
                
                // å¦‚æœå·²ç»ç»“æŸï¼Œé‡ç½®
                if (Math.abs(time - maxTime) < 0.1) {
                    setTime(0);
                    setPhase(0);
                    startFromTimeRef.current = 0;
                } else {
                    startFromTimeRef.current = time;
                }

                setIsPlaying(true);
                startTimeRef.current = null; // Reset frame timestamp
                
                // é€Ÿåº¦è®¾ç½®
                let speed = 1;
                if (scenario === 'double') speed = 20; // åŠ é€Ÿ

                const animate = (timestamp) => {
                    if (!startTimeRef.current) startTimeRef.current = timestamp;
                    const elapsed = (timestamp - startTimeRef.current) / 1000 * speed;
                    const newTime = startFromTimeRef.current + elapsed;

                    let targetTime = maxTime;
                    let shouldPause = false;

                    // æ£€æŸ¥æš‚åœç‚¹
                    if (scenario === 'double') {
                        // ç›®æ ‡1: ç¬¬ä¸€æ¬¡ç›¸é‡ t1
                        if (startFromTimeRef.current < t1 - 0.1) {
                            // å¦‚æœèµ·ç‚¹åœ¨ t1 ä¹‹å‰ï¼Œç”±äºåŠ¨ç”»å¸§é—´éš”ï¼Œå¦‚æœ newTime è¶…è¿‡ t1ï¼Œåˆ™åº”æš‚åœåœ¨ t1
                            if (newTime >= t1) {
                                targetTime = t1;
                                shouldPause = true;
                            } else {
                                targetTime = newTime; // æ­£å¸¸æ’­æ”¾
                            }
                        } 
                        // ç›®æ ‡2: ç¬¬äºŒæ¬¡ç›¸é‡ t1+dt
                        else if (startFromTimeRef.current < (t1 + dt) - 0.1) {
                            if (newTime >= t1 + dt) {
                                targetTime = t1 + dt;
                                shouldPause = true;
                            } else {
                                targetTime = newTime;
                            }
                        }
                    } else {
                        // Meeting åœºæ™¯: ç›´æ¥æ’­åˆ°ç»“æŸ
                         if (newTime >= maxTime) {
                            targetTime = maxTime;
                            shouldPause = true;
                         } else {
                             targetTime = newTime;
                         }
                    }

                    setTime(targetTime);

                    if (shouldPause) {
                        setIsPlaying(false);
                        // æ›´æ–°é˜¶æ®µ
                        if (scenario === 'double') {
                             if (Math.abs(targetTime - t1) < 0.1) setPhase(1);
                             else if (Math.abs(targetTime - (t1+dt)) < 0.1) setPhase(2);
                        } else {
                            if (Math.abs(targetTime - maxTime) < 0.1) setPhase(2);
                        }
                    } else {
                        animationRef.current = requestAnimationFrame(animate);
                    }
                };
                animationRef.current = requestAnimationFrame(animate);
            };

            const pauseAnimation = () => {
                setIsPlaying(false);
                if (animationRef.current) cancelAnimationFrame(animationRef.current);
            };
            
            const togglePlay = () => {
                if (isPlaying) {
                    pauseAnimation();
                } else {
                    startAnimation();
                }
            };

            // åŠ¨æ€ç”Ÿæˆå¼•å¯¼è¯­
            const getInstruction = () => {
                const custom = config.getInstruction(step, diagramSubStep);
                if (custom) return custom;

                switch(step) {
                    case STEPS.READ: return "ç¬¬ä¸€æ­¥ï¼šå…ˆé€šè¯»é¢˜ç›®ï¼Œäº†è§£å¤§æ¦‚æ„æ€ã€‚";
                    case STEPS.HIGHLIGHT: return "ç¬¬äºŒæ­¥ï¼šåœˆå‡ºé‡ç‚¹è¯ã€‚è°å’Œè°ç›¸é‡ï¼Ÿæ—¶é—´å…³ç³»ï¼Ÿ";
                    case STEPS.ANIMATE: return "ç¬¬ä¸‰æ­¥ï¼šè„‘æµ·é‡Œâ€œæ’­æ”¾â€è¿‡ç¨‹ã€‚";
                    case STEPS.DIAGRAM: return "ç¬¬å››æ­¥ï¼šæŠŠè¿‡ç¨‹ç”»åœ¨çº¸ä¸Šã€‚"; 
                    case STEPS.FORMULA: return "ç¬¬äº”æ­¥ï¼šæ ¹æ®çº¿æ®µå›¾çš„é•¿çŸ­å…³ç³»ï¼Œåˆ—å‡ºç®—å¼ã€‚";
                    default: return "";
                }
            };

            const KeyPoint = ({ children, label, type, active }) => {
                if (!active) return <span>{children}</span>;
                let colorClasses = "";
                if (type === 'direction') colorClasses = "bg-orange-100 border-orange-400 text-orange-900"; 
                if (type === 'time') colorClasses = "bg-blue-100 border-blue-400 text-blue-900"; 
                if (type === 'unit') colorClasses = "bg-green-100 border-green-400 text-green-900"; 
                if (type === 'special') colorClasses = "bg-purple-100 border-purple-400 text-purple-900"; 
                return (
                    <span className={`relative inline-block border-b-2 px-1 mx-0.5 rounded pb-0.5 cursor-help ${colorClasses} font-bold transition-all duration-500`}>
                        {children}
                        <span className={`absolute top-full left-1/2 -translate-x-1/2 text-[10px] font-bold bg-white/90 px-1.5 py-0.5 rounded shadow-sm whitespace-nowrap mt-1 border z-10 ${colorClasses.replace('bg-', 'border-').split(' ')[1]}`}>
                            {label}
                        </span>
                    </span>
                );
            };

            const renderProblemText = () => {
                const h = (text, condition) => (
                    <span className={`${condition ? 'bg-yellow-200 ring-2 ring-yellow-300 rounded px-1' : ''} transition-all duration-300`}>{text}</span>
                );
                const isHighlightStep = step === STEPS.HIGHLIGHT;
                
                if (scenario === 'meeting') {
                    return (
                        <span className="leading-[3rem]"> 
                            <span className="text-red-600 font-bold">{label1}</span>å’Œ<span className="text-blue-600 font-bold">{label2}</span>
                            <KeyPoint label="æ—¶é—´ç›¸åŒ" type="time" active={isHighlightStep}>åŒæ—¶</KeyPoint>
                            ä»ç”²ã€ä¹™ä¸¤åœ°éª‘è½¦
                            <KeyPoint label="å…³é”®æ–¹å‘" type="direction" active={isHighlightStep}>
                                {step===STEPS.DIAGRAM && diagramSubStep===1 ? h("ç›¸å‘è€Œè¡Œ", true) : "ç›¸å‘è€Œè¡Œ"}
                            </KeyPoint>
                            ï¼Œ
                            {label1}æ¯å°æ—¶è¡Œ<KeyPoint label="é€Ÿåº¦å¿«" type="unit" active={isHighlightStep}>{v1}åƒç±³</KeyPoint>ï¼Œ
                            {label2}æ¯å°æ—¶è¡Œ<KeyPoint label="é€Ÿåº¦æ…¢" type="unit" active={isHighlightStep}>{v2}åƒç±³</KeyPoint>ï¼Œ
                            ä¸¤äººåœ¨
                            <KeyPoint label="å…³é”®æ¡ä»¶" type="special" active={isHighlightStep}>
                                {step===STEPS.DIAGRAM && diagramSubStep>=2 ? h(`è·ä¸­ç‚¹ ${offset} åƒç±³`, true) : `è·ä¸­ç‚¹ ${offset} åƒç±³`}
                            </KeyPoint>
                            çš„åœ°æ–¹{step===STEPS.DIAGRAM && diagramSubStep===3 ? h("ç›¸é‡", true) : "ç›¸é‡"}ã€‚
                            ç”²ã€ä¹™ä¸¤åœ°ç›¸è·å¤šå°‘åƒç±³ï¼Ÿ
                        </span>
                    );
                } else if (scenario === 'double') {
                    return (
                        <span className="leading-[3rem]">
                             <span className="text-red-600 font-bold">{labelA}</span>ä»Aåœ°ï¼Œ
                             <span className="text-blue-600 font-bold">{labelB}</span>ã€
                             <span className="text-green-600 font-bold">{labelC}</span>ä»Båœ°ï¼Œ
                             ä¸‰äºº<KeyPoint label="æ—¶é—´ç›¸åŒ" type="time" active={isHighlightStep}>åŒæ—¶å‡ºå‘</KeyPoint>
                             <KeyPoint label="æ–¹å‘ç›¸å¯¹" type="direction" active={isHighlightStep}>ç›¸å‘è€Œè¡Œ</KeyPoint>ã€‚
                             å½“{labelA}ä¸{labelB}<KeyPoint label="ç¬¬ä¸€æ¬¡ç›¸é‡" type="special" active={isHighlightStep}>{step===STEPS.DIAGRAM && diagramSubStep===3 ? h("ç›¸é‡", true) : "ç›¸é‡"}</KeyPoint>åï¼Œ
                             åˆè¿‡äº†<KeyPoint label="æ—¶é—´å·®" type="time" active={isHighlightStep}>{step===STEPS.DIAGRAM && diagramSubStep===5 ? h(`${dt}åˆ†é’Ÿ`, true) : `${dt}åˆ†é’Ÿ`}</KeyPoint>
                             {labelA}ä¸{labelC}<KeyPoint label="ç¬¬äºŒæ¬¡ç›¸é‡" type="special" active={isHighlightStep}>{step===STEPS.DIAGRAM && diagramSubStep>=4 ? h("ç›¸é‡", true) : "ç›¸é‡"}</KeyPoint>ã€‚
                             å·²çŸ¥{labelA}æ¯åˆ†è¡Œ<KeyPoint label="å•ä½:ç±³" type="unit" active={isHighlightStep}>{vA}ç±³</KeyPoint>ï¼Œ
                             {labelB}æ¯åˆ†è¡Œ<KeyPoint label="å•ä½:ç±³" type="unit" active={isHighlightStep}>{vB}ç±³</KeyPoint>ï¼Œ
                             {labelC}æ¯åˆ†è¡Œ<KeyPoint label="å•ä½:ç±³" type="unit" active={isHighlightStep}>{vC}ç±³</KeyPoint>ã€‚
                             æ±‚Aã€Bä¸¤åœ°çš„è·ç¦»ï¼Ÿ
                        </span>
                    );
                }
            };

            const renderAnimation = () => {
                const maxTime = (scenario === 'double') ? (t1 + dt) : t;
                const progress = Math.min(100, (time / maxTime) * 100);

                let content = null;

                if (scenario === 'meeting') {
                    const totalDist = (v1+v2)*t;
                    // Leave padding: 10% on left, 10% on right
                    const roadStart = 10;
                    const roadEnd = 90;
                    const roadWidth = 80;
                    
                    const leftPos = roadStart + (v1 * time) / totalDist * roadWidth;
                    const rightPos = roadEnd - (v2 * time) / totalDist * roadWidth;
                    
                    content = (
                        <div className="h-full relative road flex items-center">
                             <div className="absolute top-1/2 left-[10%] w-[80%] border-t border-dashed border-gray-400"></div>
                             
                             {/* ä¸­ç‚¹ */}
                             <div className="absolute top-0 bottom-0 left-1/2 border-l-2 border-dashed border-gray-400 z-0 opacity-50">
                                 <div className="absolute top-2 left-1 text-gray-500 text-xs font-bold">ä¸­ç‚¹</div>
                             </div>

                             {/* å·¦ä¾§å°çº¢ */}
                             <div className="absolute top-0 bottom-0 left-[10%] bg-red-100/30" style={{ width: `${leftPos - 10}%` }}></div>
                             <div className="absolute top-1/2 -translate-y-1/2 z-10 flex flex-col items-center transition-none" style={{ left: `${leftPos}%`, transform: 'translate(-50%, -50%)' }}>
                                 <span className="text-4xl transform scale-x-[-1] block">ğŸ‘§ğŸ»</span>
                                 <div className="text-xs bg-white/80 rounded px-1 shadow mt-1 font-bold text-red-600">ç”²</div>
                             </div>

                             {/* å³ä¾§å°æ˜ */}
                             <div className="absolute top-0 bottom-0 right-[10%] bg-blue-100/30" style={{ width: `${90 - rightPos}%` }}></div>
                             <div className="absolute top-1/2 -translate-y-1/2 z-10 flex flex-col items-center transition-none" style={{ left: `${rightPos}%`, transform: 'translate(-50%, -50%)' }}>
                                 <span className="text-4xl block">ğŸ‘¦ğŸ»</span>
                                 <div className="text-xs bg-white/80 rounded px-1 shadow mt-1 font-bold text-blue-600">ä¹™</div>
                             </div>

                             {time >= t && (
                                 <div className="absolute left-[52%] top-12 transform -translate-x-1/2 bg-yellow-400 text-xs px-2 py-1 rounded font-bold shadow animate-bounce z-20">
                                     ç›¸é‡ç‚¹
                                 </div>
                             )}
                        </div>
                    );
                } else if (scenario === 'double') {
                    const totalDist = (vA + vB) * t1; 
                    const roadStart = 10;
                    const roadEnd = 90;
                    const roadWidth = 80;

                    const getPos = (val, fromRight = false) => {
                        const pct = (val / totalDist) * roadWidth;
                        return fromRight ? (roadEnd - pct) : (roadStart + pct);
                    };

                    const posA = getPos(vA * time);
                    const posB = getPos(vB * time, true);
                    const posC = getPos(vC * time, true);
                    
                    content = (
                        <div className="h-full relative bg-slate-100 flex flex-col justify-center">
                            {/* Road Markings */}
                            <div className="absolute top-1/2 w-[80%] left-[10%] border-t-2 border-dashed border-gray-400"></div>
                            <div className="absolute left-[2%] top-1/2 -translate-y-1/2 font-bold text-gray-500 bg-slate-100 px-2 border-r-4 border-gray-700 h-8 flex items-center">Aåœ°</div>
                            <div className="absolute right-[2%] top-1/2 -translate-y-1/2 font-bold text-gray-500 bg-slate-100 px-2 border-l-4 border-gray-700 h-8 flex items-center">Båœ°</div>

                            {/* Character A */}
                            <div className="absolute top-1/2 -translate-y-1/2 z-20 flex flex-col items-center transition-none" style={{ left: `${Math.min(posA, 100)}%`, transform: 'translate(-50%, -50%)' }}>
                                <span className="text-3xl transform scale-x-[-1] block">ğŸ”´</span>
                                <span className="text-xs font-bold text-red-600">ç”²</span>
                            </div>

                            {/* Character B */}
                            <div className="absolute top-1/2 -translate-y-1/2 z-20 flex flex-col items-center transition-none" style={{ left: `${Math.min(posB, 100)}%`, transform: 'translate(-50%, -80%)' }}>
                                <span className="text-3xl block">ğŸ”µ</span>
                                <span className="text-xs font-bold text-blue-600">ä¹™</span>
                            </div>

                            {/* Character C */}
                            <div className="absolute top-1/2 -translate-y-1/2 z-10 flex flex-col items-center transition-none" style={{ left: `${Math.min(posC, 100)}%`, transform: 'translate(-50%, -20%)' }}>
                                <span className="text-2xl block opacity-80">ğŸŸ¢</span>
                                <span className="text-xs font-bold text-green-600">ä¸™</span>
                            </div>

                            {/* 8åˆ†é’Ÿ Interval Visual */}
                            {time > t1 && (
                                <div className="absolute top-[60%] z-0 h-6 bg-yellow-100/80 border-x-2 border-yellow-500 flex items-center justify-center text-[10px] text-yellow-800 font-bold whitespace-nowrap shadow-sm"
                                     style={{ 
                                         left: `${getPos(vA*t1)}%`, 
                                         width: `${getPos(vA*time) - getPos(vA*t1)}%` 
                                     }}>
                                    {(time - t1).toFixed(0)} min
                                </div>
                            )}
                        </div>
                    );
                }

                // ç»Ÿä¸€çš„åŠ¨ç”»å®¹å™¨å’Œæ§åˆ¶å±‚
                return (
                    <div className="h-64 relative border-2 border-gray-300 rounded-lg overflow-hidden bg-white shadow-inner flex flex-col">
                        <div className="flex-1 relative overflow-hidden">
                            {content}
                            
                            {/* é¡¶éƒ¨è½»é‡çº§çŠ¶æ€æç¤º (ä¸é®æŒ¡) */}
                            <div className="absolute top-2 left-1/2 transform -translate-x-1/2 z-10">
                                <div className="bg-white/90 backdrop-blur px-4 py-1.5 rounded-full shadow-sm border border-slate-200 text-xs font-bold flex items-center gap-2">
                                    <span className={`w-2 h-2 rounded-full ${isPlaying ? 'bg-green-500 animate-pulse' : 'bg-slate-400'}`}></span>
                                    {isPlaying ? "åŠ¨ç”»æ¼”ç¤ºä¸­..." : 
                                     (phase === 1 ? "æš‚åœä¸­ï¼šå·²åˆ°è¾¾ç¬¬ä¸€æ¬¡ç›¸é‡ç‚¹" : 
                                     (phase === 2 ? "æ¼”ç¤ºç»“æŸ" : "å‡†å¤‡å°±ç»ª"))}
                                </div>
                            </div>
                        </div>

                        {/* åº•éƒ¨æ§åˆ¶æ  */}
                        <div className="h-14 bg-slate-50 border-t border-gray-200 flex items-center px-4 gap-4 z-40">
                            {/* æ™ºèƒ½æ’­æ”¾æŒ‰é’® */}
                            <button 
                                onClick={togglePlay} 
                                className={`flex items-center gap-2 px-4 py-2 rounded-lg font-bold text-white transition-all shadow-md active:scale-95
                                    ${(!isPlaying && (phase === 0 || phase === 1)) ? 'bg-blue-600 hover:bg-blue-700 pulse-btn' : 
                                      (isPlaying ? 'bg-slate-500 hover:bg-slate-600' : 'bg-green-600 hover:bg-green-700')}
                                `}
                            >
                                {isPlaying ? <PauseCircle size={20} /> : (phase===2 ? <RefreshCw size={20}/> : <PlayCircle size={20} />)}
                                <span>{isPlaying ? "æš‚åœ" : (phase===1 ? "ç»§ç»­æ’­æ”¾" : (phase===2 ? "é‡æ–°å¼€å§‹" : "å¼€å§‹"))}</span>
                            </button>
                            
                            {/* è¿›åº¦æ¡æ˜¾ç¤º */}
                            <div className="flex-1 flex items-center gap-3">
                                <div className="flex-1 h-3 bg-gray-200 rounded-full overflow-hidden border border-gray-300 relative">
                                    <div className="h-full bg-blue-500 transition-all duration-75 ease-linear" style={{ width: `${progress}%` }}></div>
                                    {/* åˆ»åº¦ç‚¹ */}
                                    {scenario === 'double' && (
                                        <>
                                            <div className="absolute top-0 bottom-0 w-0.5 bg-white/50" style={{left: `${(t1/maxTime)*100}%`}}></div>
                                        </>
                                    )}
                                </div>
                                <span className="text-xs font-mono text-slate-500 w-16 text-right font-bold">
                                    {time.toFixed(0)} / {maxTime.toFixed(0)} {scenario==='meeting'?'h':'m'}
                                </span>
                            </div>
                        </div>
                    </div>
                );
            };

            const renderDiagram = () => {
                const svgWidth = 600;
                const commonViewBox = "-50 -50 700 350"; // å¢åŠ é«˜åº¦ä»¥ä¾¿å®¹çº³æ›´å¤šæ­¥éª¤
                
                if (scenario === 'meeting') {
                    // (ä¿ç•™ç¬¬ä¸€é¢˜çš„ç»˜å›¾é€»è¾‘)
                    const totalRatio = v1 + v2; 
                    const meetRatio = v1 / totalRatio; 
                    const meetX = meetRatio * svgWidth;
                    const midpointX = svgWidth / 2;
                    
                    return (
                         <svg viewBox="-50 -50 700 250" className="w-full h-auto overflow-visible">
                            <defs>
                                <marker id="arrow-r" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto"><polygon points="0 0, 10 3.5, 0 7" fill="#dc2626" /></marker>
                                <marker id="arrow-b" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto"><polygon points="0 0, 10 3.5, 0 7" fill="#2563eb" /></marker>
                            </defs>
                            <g className="fade-in">
                                <line x1="10" y1="80" x2={svgWidth-10} y2="80" stroke="#333" strokeWidth="2"/>
                                <line x1="10" y1="75" x2="10" y2="85" stroke="#333" strokeWidth="2"/>
                                <text x="10" y="55" textAnchor="middle" fill="#dc2626" fontWeight="bold" fontSize="16">ç”²(å°çº¢)</text>
                                <line x1={svgWidth-10} y1="75" x2={svgWidth-10} y2="85" stroke="#333" strokeWidth="2"/>
                                <text x={svgWidth-10} y="55" textAnchor="middle" fill="#2563eb" fontWeight="bold" fontSize="16">ä¹™(å°æ˜)</text>
                                <line x1={midpointX} y1="60" x2={midpointX} y2="100" stroke="#94a3b8" strokeWidth="2" strokeDasharray="5,5"/>
                                <text x={midpointX} y="50" textAnchor="middle" fill="#94a3b8" fontSize="14">ä¸­ç‚¹</text>
                            </g>
                            {diagramSubStep >= 1 && (
                                <g className="fade-in">
                                    <line x1="30" y1="70" x2="150" y2="70" stroke="#dc2626" strokeWidth="2" markerEnd="url(#arrow-r)" />
                                    <text x="90" y="60" textAnchor="middle" fill="#dc2626" fontSize="12">18km/h</text>
                                    <line x1={svgWidth-30} y1="70" x2={svgWidth-150} y2="70" stroke="#2563eb" strokeWidth="2" markerEnd="url(#arrow-b)" />
                                    <text x={svgWidth-90} y="60" textAnchor="middle" fill="#2563eb" fontSize="12">15km/h</text>
                                </g>
                            )}
                            {diagramSubStep >= 2 && (
                                <g className="fade-in">
                                    <path transform={`translate(${meetX}, 75)`} d="M0 0 L0 15 M0 0 L15 5 L0 10 Z" fill="#eab308" stroke="#ca8a04"/>
                                    <text x={meetX} y="110" textAnchor="middle" fill="#ca8a04" fontWeight="bold" fontSize="14">ç›¸é‡ç‚¹</text>
                                    <path d={`M ${midpointX} 90 L ${meetX} 90`} stroke="#7c3aed" strokeWidth="2"/>
                                    <line x1={midpointX} y1="85" x2={midpointX} y2="95" stroke="#7c3aed"/>
                                    <line x1={meetX} y1="85" x2={meetX} y2="95" stroke="#7c3aed"/>
                                    <text x={(midpointX + meetX)/2} y="105" textAnchor="middle" fill="#7c3aed" fontSize="12" fontWeight="bold">3km</text>
                                </g>
                            )}
                            {diagramSubStep >= 3 && (
                                <g className="fade-in">
                                    <text x={svgWidth/2} y="140" textAnchor="middle" fill="#666" fontSize="14">
                                        å°çº¢æ¯”ä¸€åŠå¤šèµ° 3kmï¼Œå°æ˜æ¯”ä¸€åŠå°‘èµ° 3km
                                    </text>
                                    <text x={svgWidth/2} y="160" textAnchor="middle" fill="#dc2626" fontWeight="bold" fontSize="14">
                                        æ‰€ä»¥ï¼šå°çº¢æ¯”å°æ˜å¤šèµ° 3Ã—2 = 6km
                                    </text>
                                </g>
                            )}
                        </svg>
                    );
                } else if (scenario === 'double') {
                    // äºŒæ¬¡ç›¸é‡å›¾ç¤º - 6æ­¥æ³•
                    // æ€»é•¿åº¦å¯¹åº” (vA+vB)*t1 = 14560
                    const meet1X = (vA / (vA + vB)) * svgWidth; // ç”²ä¹™ç›¸é‡ç‚¹
                    const meet2X = (vA * (t1 + dt)) / ((vA + vB) * t1) * svgWidth; // ç”²ä¸™ç›¸é‡ç‚¹ (ç”²ç»§ç»­èµ°)
                    
                    return (
                        <svg viewBox={commonViewBox} className="w-full h-auto overflow-visible">
                            <defs>
                                <marker id="arrow-red" markerWidth="8" markerHeight="6" refX="7" refY="3" orient="auto"><polygon points="0 0, 8 3, 0 6" fill="#dc2626" /></marker>
                                <marker id="arrow-blue" markerWidth="8" markerHeight="6" refX="7" refY="3" orient="auto"><polygon points="0 0, 8 3, 0 6" fill="#2563eb" /></marker>
                                <marker id="arrow-green" markerWidth="8" markerHeight="6" refX="7" refY="3" orient="auto"><polygon points="0 0, 8 3, 0 6" fill="#16a34a" /></marker>
                            </defs>
                            
                            {/* Step 0: ç”»çº¿æ®µ AB */}
                            <g className="fade-in">
                                <line x1="10" y1="100" x2={svgWidth-10} y2="100" stroke="#333" strokeWidth="2"/>
                                <line x1="10" y1="95" x2="10" y2="105" stroke="#333" strokeWidth="2"/>
                                <line x1={svgWidth-10} y1="95" x2={svgWidth-10} y2="105" stroke="#333" strokeWidth="2"/>
                                <text x="10" y="125" textAnchor="middle" fill="#333" fontWeight="bold" fontSize="16">Aåœ°</text>
                                <text x={svgWidth-10} y="125" textAnchor="middle" fill="#333" fontWeight="bold" fontSize="16">Båœ°</text>
                            </g>

                            {/* Step 1: æ ‡å‡ºç”²ä¹™ä¸™ä½ç½® */}
                            {diagramSubStep >= 1 && (
                                <g className="fade-in">
                                    <circle cx="10" cy="100" r="4" fill="#dc2626"/>
                                    <text x="10" y="85" textAnchor="middle" fill="#dc2626" fontWeight="bold">ç”²</text>
                                    
                                    <circle cx={svgWidth-10} cy="100" r="4" fill="#2563eb"/>
                                    <text x={svgWidth-10} y="85" textAnchor="middle" fill="#2563eb" fontWeight="bold">ä¹™ã€ä¸™</text>
                                </g>
                            )}

                            {/* Step 2: æ ‡æ–¹å‘ */}
                            {diagramSubStep >= 2 && (
                                <g className="fade-in">
                                    <line x1="20" y1="70" x2="80" y2="70" stroke="#dc2626" strokeWidth="2" markerEnd="url(#arrow-red)"/>
                                    <line x1={svgWidth-20} y1="70" x2={svgWidth-80} y2="70" stroke="#2563eb" strokeWidth="2" markerEnd="url(#arrow-blue)"/>
                                    <text x={svgWidth/2} y="60" textAnchor="middle" fill="#666" fontSize="12">ç›¸å‘è€Œè¡Œ</text>
                                </g>
                            )}

                            {/* Step 3: ç”²ä¹™ç›¸é‡ */}
                            {diagramSubStep >= 3 && (
                                <g className="fade-in">
                                    {/* ç”²è·¯çº¿1 */}
                                    <path d={`M 10 100 Q ${meet1X/2} 40 ${meet1X} 100`} fill="none" stroke="#dc2626" strokeWidth="2"/>
                                    {/* ä¹™è·¯çº¿ */}
                                    <path d={`M ${svgWidth-10} 100 Q ${(svgWidth-10+meet1X)/2} 40 ${meet1X} 100`} fill="none" stroke="#2563eb" strokeWidth="2"/>
                                    
                                    {/* ç›¸é‡ç‚¹1 */}
                                    <path transform={`translate(${meet1X}, 95)`} d="M0 0 L0 15 M0 0 L15 5 L0 10 Z" fill="#eab308" stroke="#ca8a04"/>
                                    <text x={meet1X} y="135" textAnchor="middle" fill="#ca8a04" fontSize="12" fontWeight="bold">ç¬¬ä¸€æ¬¡ç›¸é‡(ç”²ä¹™)</text>
                                </g>
                            )}

                            {/* Step 4: ç”²ä¸™ç›¸é‡ (ç”²ç»§ç»­èµ°ï¼Œä¸™èµ°åˆ°Meet2) */}
                            {diagramSubStep >= 4 && (
                                <g className="fade-in">
                                    {/* ç”²è·¯çº¿2 (ä»Meet1åˆ°Meet2) */}
                                    <path d={`M ${meet1X} 100 Q ${(meet1X+meet2X)/2} 80 ${meet2X} 100`} fill="none" stroke="#dc2626" strokeWidth="2" strokeDasharray="4,2"/>
                                    
                                    {/* ä¸™è·¯çº¿ (ä»èµ·ç‚¹åˆ°Meet2) - ç”»åœ¨ä¸‹æ–¹é¿å…é‡å  */}
                                    <path d={`M ${svgWidth-10} 100 Q ${(svgWidth-10+meet2X)/2} 160 ${meet2X} 100`} fill="none" stroke="#16a34a" strokeWidth="2"/>
                                    <text x={(svgWidth-10+meet2X)/2} y="150" textAnchor="middle" fill="#16a34a" fontSize="12">ä¸™çš„è·¯çº¿</text>

                                    {/* ç›¸é‡ç‚¹2 */}
                                    <path transform={`translate(${meet2X}, 95)`} d="M0 0 L0 15 M0 0 L15 5 L0 10 Z" fill="#eab308" stroke="#ca8a04"/>
                                    <text x={meet2X+10} y="85" fill="#eab308" fontSize="12" fontWeight="bold">ç¬¬äºŒæ¬¡ç›¸é‡(ç”²ä¸™)</text>
                                </g>
                            )}

                            {/* Step 5: é‡ç‚¹æ ‡æ³¨8åˆ†é’Ÿ */}
                            {diagramSubStep >= 5 && (
                                <g className="fade-in">
                                    {/* æ ‡æ³¨ç”²èµ°çš„è¿™ä¸€æ®µ */}
                                    <rect x={meet1X} y="90" width={meet2X-meet1X} height="20" fill="rgba(255,0,0,0.1)" stroke="none"/>
                                    <text x={(meet1X+meet2X)/2} y="115" textAnchor="middle" fill="#dc2626" fontWeight="bold" fontSize="10">8åˆ†é’Ÿ</text>
                                    
                                    {/* æ ‡æ³¨è¿™æ˜¯å…³é”®è·¯ç¨‹ */}
                                    <path d={`M ${meet1X} 160 L ${meet2X} 160`} stroke="#9333ea" strokeWidth="2"/>
                                    <line x1={meet1X} y1="155" x2={meet1X} y2="165" stroke="#9333ea"/>
                                    <line x1={meet2X} y1="155" x2={meet2X} y2="165" stroke="#9333ea"/>
                                    <text x={(meet1X+meet2X)/2} y="175" textAnchor="middle" fill="#9333ea" fontSize="12" fontWeight="bold">
                                        è¿™ä¸€æ®µæ˜¯ç”²8åˆ†é’Ÿèµ°çš„
                                    </text>
                                    
                                    <text x={svgWidth/2} y="220" textAnchor="middle" fill="#333" fontSize="14" fontWeight="bold" className="bg-yellow-100 px-2">
                                        å…³é”®ç‚¹ï¼šä»ç¬¬ä¸€æ¬¡ç›¸é‡åˆ°ç¬¬äºŒæ¬¡ç›¸é‡ï¼Œç”²å’Œä¸™å…±åŒèµ°äº†8åˆ†é’Ÿï¼
                                    </text>
                                </g>
                            )}
                        </svg>
                    )
                }
            };

            const renderFormula = () => {
                if(scenario === 'meeting') {
                    return (
                        <div className="text-left max-w-lg mx-auto space-y-3 font-mono text-sm md:text-base">
                             <div className="flex justify-between border-b pb-2">
                                 <span>1. è®¡ç®—é€Ÿåº¦å·®ï¼š</span>
                                 <span className="font-bold">{v1} - {v2} = <span className="text-orange-600">{v1-v2}</span> (km/h)</span>
                             </div>
                             <div className="flex justify-between border-b pb-2">
                                 <span>2. è®¡ç®—è·¯ç¨‹å·®(è·ä¸­ç‚¹{offset}km Ã— 2)ï¼š</span>
                                 <span className="font-bold">{offset} Ã— 2 = <span className="text-orange-600">{offset*2}</span> (km)</span>
                             </div>
                             <div className="flex justify-between border-b pb-2">
                                 <span>3. è®¡ç®—ç›¸é‡æ—¶é—´(è·¯ç¨‹å·®Ã·é€Ÿåº¦å·®)ï¼š</span>
                                 <span className="font-bold">{offset*2} Ã· {v1-v2} = <span className="text-blue-600">{t}</span> (h)</span>
                             </div>
                             <div className="flex justify-between bg-yellow-100 p-2 rounded">
                                 <span>4. è®¡ç®—æ€»è·¯ç¨‹(é€Ÿåº¦å’ŒÃ—æ—¶é—´)ï¼š</span>
                                 <span className="font-bold text-lg">({v1}+{v2}) Ã— {t} = <span className="text-red-600">{(v1+v2)*t}</span> (km)</span>
                             </div>
                        </div>
                    )
                } else if (scenario === 'double') {
                     return (
                        <div className="text-left max-w-lg mx-auto space-y-3 font-mono text-sm md:text-base">
                             <div className="flex justify-between border-b pb-2">
                                 <span>1. å…³é”®è·¯ç¨‹(ä¹™ä¸™å·®è· = ç”²ä¸™åˆèµ°8åˆ†é’Ÿ)ï¼š</span>
                                 <span className="font-bold">({vA} + {vC}) Ã— {dt} = <span className="text-purple-600">{(vA+vC)*dt}</span> (ç±³)</span>
                             </div>
                             <div className="flex justify-between border-b pb-2">
                                 <span>2. ä¹™ä¸™é€Ÿåº¦å·®ï¼š</span>
                                 <span className="font-bold">{vB} - {vC} = <span className="text-orange-600">{vB-vC}</span> (ç±³/åˆ†)</span>
                             </div>
                             <div className="flex justify-between border-b pb-2">
                                 <span>3. æ±‚ç”²ä¹™ç›¸é‡æ—¶é—´(å·®è·Ã·é€Ÿåº¦å·®)ï¼š</span>
                                 <span className="font-bold">{(vA+vC)*dt} Ã· {vB-vC} = <span className="text-blue-600">{t1}</span> (åˆ†)</span>
                             </div>
                             <div className="flex justify-between bg-yellow-100 p-2 rounded">
                                 <span>4. è®¡ç®—æ€»è·¯ç¨‹(ç”²ä¹™åˆèµ°)ï¼š</span>
                                 <span className="font-bold text-lg">({vA}+{vB}) Ã— {t1} = <span className="text-red-600">{(vA+vB)*t1}</span> (ç±³)</span>
                             </div>
                        </div>
                    )
                }
            }

            return (
                <div className="min-h-screen p-4 flex flex-col items-center bg-slate-50">
                    <div className="bg-white rounded-xl shadow-lg w-full max-w-4xl overflow-hidden border border-slate-200 flex flex-col min-h-[650px]">
                        <div className="flex border-b border-slate-200 bg-slate-50">
                            {Object.values(SCENARIOS).map(s => (
                                <button key={s.id} onClick={() => switchScenario(s.id)} className={`flex-1 py-3 font-bold text-sm flex items-center justify-center gap-2 transition-colors ${scenario === s.id ? 'bg-white text-blue-600 border-t-2 border-blue-600' : 'text-slate-500 hover:bg-slate-100'}`}>
                                    {s.icon} {s.title}
                                </button>
                            ))}
                        </div>
                        <div className="bg-white border-b border-slate-200 p-2">
                            <div className="flex flex-wrap justify-center gap-2">
                                {STEP_CONFIG.map((s) => (
                                    <button key={s.id} onClick={() => changeStep(s.id)} className={`px-3 py-2 rounded-lg text-xs md:text-sm font-bold flex items-center gap-1 transition-all ${step === s.id ? 'bg-blue-600 text-white shadow-md' : 'bg-slate-100 text-slate-500 hover:bg-slate-200'}`}>
                                        {step > s.id ? <CheckCircle size={14} /> : s.icon} {s.label}
                                    </button>
                                ))}
                            </div>
                        </div>
                        <div className="p-6 text-center border-b border-dashed border-slate-200 bg-slate-50/50">
                            <div className="text-lg md:text-xl text-slate-800 leading-relaxed font-serif">
                                {renderProblemText()}
                            </div>
                        </div>
                        <div className="flex-1 p-6 relative flex flex-col justify-center min-h-[400px]">
                            {step === STEPS.ANIMATE && (
                                <div className="mb-4 fade-in w-full">
                                    {renderAnimation()}
                                </div>
                            )}
                            {step >= STEPS.DIAGRAM && (
                                <div className="fade-in bg-white p-4 border border-slate-200 rounded-lg shadow-sm relative mt-2">
                                    <div className="absolute -top-3 left-4 bg-white text-slate-500 px-2 text-sm font-bold flex items-center border border-slate-200 rounded shadow-sm">
                                        <Pencil size={14} className="mr-1"/> çº¿æ®µå›¾ç»˜åˆ¶
                                    </div>
                                    <div className="w-full pt-4 overflow-visible flex justify-center">
                                        {renderDiagram()}
                                    </div>
                                    {step === STEPS.DIAGRAM && (
                                        <div className="flex justify-center gap-2 mt-4">
                                            {/* åŠ¨æ€ç”Ÿæˆæ­¥éª¤æŒ‡ç¤ºå™¨ */}
                                            {Array.from({length: config.maxDiagramStep + 1}).map((_, i) => (
                                                <div key={i} className={`h-1.5 w-6 rounded-full transition-colors ${diagramSubStep >= i ? 'bg-blue-500' : 'bg-gray-200'}`}></div>
                                            ))}
                                        </div>
                                    )}
                                </div>
                            )}
                             {step === STEPS.FORMULA && (
                                <div className="mt-4 bg-yellow-50 p-6 rounded-lg border border-yellow-200 fade-in text-center">
                                    <div className="text-sm text-slate-500 mb-2">æ ¹æ®çº¿æ®µå›¾å…³ç³»å¯å¾—ï¼š</div>
                                    {renderFormula()}
                                </div>
                            )}
                        </div>
                        <div className="bg-slate-50 p-4 border-t border-slate-200 flex justify-between items-center">
                            <div className="text-slate-600 text-sm font-medium flex items-center flex-1 mr-4">
                                <span className="mr-2 text-xl">ğŸ’¡</span> 
                                <span>{getInstruction()}</span>
                            </div>
                            {step < STEPS.FORMULA ? (
                                <button onClick={handleNextClick} className="bg-blue-600 hover:bg-blue-700 text-white px-5 py-2 rounded-full font-bold shadow-md transition-all active:scale-95 flex items-center gap-2 whitespace-nowrap">
                                    {(step === STEPS.DIAGRAM && diagramSubStep < config.maxDiagramStep) ? 'ç”»ä¸‹ä¸€æ­¥' : 'ä¸‹ä¸€æ­¥'} <ChevronRight size={18}/>
                                </button>
                            ) : (
                                <button onClick={() => switchScenario(scenario)} className="bg-slate-600 hover:bg-slate-700 text-white px-5 py-2 rounded-full font-bold shadow-md transition-all active:scale-95 flex items-center gap-2 whitespace-nowrap">
                                    å†æ¥ä¸€æ¬¡ <RefreshCw size={18}/>
                                </button>
                            )}
                        </div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>